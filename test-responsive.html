<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Chart Preview Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1d29;
            color: #e2e8f0;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #212530;
            border-radius: 8px;
            border: 1px solid #2a2d3a;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-card {
            background: #2a2d3a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #3a4553;
        }
        .test-result {
            font-family: monospace;
            font-size: 14px;
            margin-top: 10px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #06b6d4; }
        
        .viewport-simulator {
            border: 2px solid #6366f1;
            margin: 20px 0;
            background: white;
            position: relative;
            overflow: hidden;
        }
        .viewport-label {
            position: absolute;
            top: -25px;
            left: 0;
            background: #6366f1;
            color: white;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        /* Responsive test styles */
        .zone1-test, .zone2-test {
            display: inline-block;
            height: 40px;
            margin: 5px;
            border-radius: 4px;
        }
        
        .zone1-test {
            background: #ef4444;
            width: 240px;
        }
        .zone2-test {
            background: #10b981;
            width: 360px;
        }
        
        /* Responsive breakpoints */
        @media (max-width: 1199px) {
            .zone1-test { width: 220px; }
            .zone2-test { width: 320px; }
        }
        
        @media (max-width: 767px) {
            .zone1-test { width: 200px; }
            .zone2-test { width: 280px; }
        }
        
        .chart-preview-test {
            background: #1a1f26;
            border: 1px solid rgba(47, 58, 74, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .chart-container-test {
            background: #000;
            border-radius: 8px;
            padding: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background: #6366f1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #5855eb;
        }
        
        button.active {
            background: #10b981;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Responsive Chart Preview Test</h1>
        
        <div class="test-section">
            <h2>üì± Viewport Information</h2>
            <div class="test-result">
                <div id="viewport-info"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìè Responsive Zone Width Test</h2>
            <p>These colored bars should resize based on the current viewport:</p>
            <div>
                <div class="zone1-test"></div>
                <span class="info">Zone 1 (red): 240px desktop, 220px tablet, 200px mobile</span>
            </div>
            <div>
                <div class="zone2-test"></div>
                <span class="info">Zone 2 (green): 360px desktop, 320px tablet, 280px mobile</span>
            </div>
            <div class="test-result" id="zone-test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Chart Size Preset Test</h2>
            <div class="controls">
                <button onclick="testChartPreset('mobile')">Mobile (750√ó1334)</button>
                <button onclick="testChartPreset('story')">Story (1080√ó1920)</button>
                <button onclick="testChartPreset('instagram')">Instagram (1080√ó1080)</button>
                <button onclick="testChartPreset('web')">Web (1200√ó800)</button>
                <button onclick="testChartPreset('presentation')">Presentation (1920√ó1080)</button>
            </div>
            
            <div class="chart-preview-test" id="chart-preview-test">
                <div class="chart-container-test" id="chart-container-test">
                    <div>Select a chart preset to test</div>
                </div>
            </div>
            
            <div class="test-result" id="chart-test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üîß Responsive Calculations Test</h2>
            <div class="test-result" id="calculations-result"></div>
        </div>
        
        <div class="test-section">
            <h2>üìã Test Summary</h2>
            <div class="test-result" id="summary-result"></div>
        </div>
    </div>

    <script>
        // Chart size presets (from lib/chart-constants.ts)
        const SIZE_PRESETS = {
            'presentation': { width: 1920, height: 1080, preset: 'Google Slides / PowerPoint', aspectRatio: '16:9' },
            'web': { width: 1200, height: 800, preset: 'Web / email', aspectRatio: '3:2' },
            'linkedin': { width: 1200, height: 628, preset: 'LinkedIn post', aspectRatio: '1.91:1' },
            'instagram': { width: 1080, height: 1080, preset: 'Instagram post', aspectRatio: '1:1' },
            'story': { width: 1080, height: 1920, preset: 'TikTok / Instagram story', aspectRatio: '9:16' },
            'twitter': { width: 1200, height: 675, preset: 'X (Twitter)', aspectRatio: '16:9' },
            'mobile': { width: 750, height: 1334, preset: 'Mobile', aspectRatio: '9:16' }
        };

        let currentPreset = null;
        let testResults = {};

        function updateViewportInfo() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const devicePixelRatio = window.devicePixelRatio || 1;
            
            const breakpoint = width < 768 ? 'mobile' : (width < 1200 ? 'tablet' : 'desktop');
            
            const info = `
                <div><strong>Viewport:</strong> ${width}√ó${height}px</div>
                <div><strong>Device Pixel Ratio:</strong> ${devicePixelRatio}</div>
                <div><strong>Breakpoint:</strong> ${breakpoint}</div>
            `;
            
            document.getElementById('viewport-info').innerHTML = info;
            
            // Update zone width test
            testZoneWidths(width, breakpoint);
            
            // Re-test current preset if one is selected
            if (currentPreset) {
                testChartPreset(currentPreset);
            }
            
            // Update calculations
            updateCalculationsTest();
        }

        function testZoneWidths(width, breakpoint) {
            const expectedWidths = {
                'mobile': { zone1: 200, zone2: 280 },
                'tablet': { zone1: 220, zone2: 320 },
                'desktop': { zone1: 240, zone2: 360 }
            };
            
            const expected = expectedWidths[breakpoint];
            const zone1Element = document.querySelector('.zone1-test');
            const zone2Element = document.querySelector('.zone2-test');
            
            const zone1Width = parseInt(window.getComputedStyle(zone1Element).width);
            const zone2Width = parseInt(window.getComputedStyle(zone2Element).width);
            
            const zone1Correct = zone1Width === expected.zone1;
            const zone2Correct = zone2Width === expected.zone2;
            
            const result = `
                <div class="${zone1Correct ? 'success' : 'error'}">
                    Zone 1: ${zone1Width}px (expected ${expected.zone1}px) ${zone1Correct ? '‚úì' : '‚úó'}
                </div>
                <div class="${zone2Correct ? 'success' : 'error'}">
                    Zone 2: ${zone2Width}px (expected ${expected.zone2}px) ${zone2Correct ? '‚úì' : '‚úó'}
                </div>
            `;
            
            document.getElementById('zone-test-result').innerHTML = result;
            
            testResults.zoneWidths = {
                breakpoint,
                zone1: { actual: zone1Width, expected: expected.zone1, correct: zone1Correct },
                zone2: { actual: zone2Width, expected: expected.zone2, correct: zone2Correct }
            };
        }

        function testChartPreset(presetName) {
            currentPreset = presetName;
            
            // Clear active states
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const preset = SIZE_PRESETS[presetName];
            const aspectRatio = preset.width / preset.height;
            const isPortrait = aspectRatio < 0.8;
            
            // Mirror the getContainerDimensions logic from chart-preview.tsx
            const windowSize = { width: window.innerWidth, height: window.innerHeight };
            const titleSpace = 80;
            const legendSpace = 50;
            const padding = 48;
            const reservedHeight = titleSpace + legendSpace + padding;
            
            const availableViewportWidth = windowSize.width > 0 ? windowSize.width - 640 : 800;
            const availableViewportHeight = windowSize.height > 0 ? windowSize.height - 180 : 600;
            
            const maxContainerWidth = Math.min(
                Math.max(availableViewportWidth * 0.95, aspectRatio < 0.8 ? 400 : 600),
                aspectRatio < 0.8 ? 500 : 1000
            );
            
            const maxContainerHeight = Math.min(
                Math.max(availableViewportHeight * 0.85, aspectRatio < 0.8 ? 600 : 500),
                aspectRatio < 0.8 ? 900 : 700
            );
            
            const availableHeight = maxContainerHeight - reservedHeight;
            
            let containerWidth = maxContainerWidth;
            let containerHeight = maxContainerWidth / aspectRatio;
            
            if (containerHeight > availableHeight) {
                containerHeight = availableHeight;
                containerWidth = availableHeight * aspectRatio;
            }
            
            containerWidth = Math.max(containerWidth, aspectRatio < 0.8 ? 350 : 500);
            containerHeight = Math.max(containerHeight, aspectRatio < 0.8 ? 400 : 300);
            
            const finalHeight = containerHeight + reservedHeight;
            
            // Update the test chart container
            const chartContainer = document.getElementById('chart-container-test');
            chartContainer.style.width = containerWidth + 'px';
            chartContainer.style.height = finalHeight + 'px';
            chartContainer.innerHTML = `
                <div><strong>${preset.preset}</strong></div>
                <div>Original: ${preset.width}√ó${preset.height}</div>
                <div>Aspect Ratio: ${aspectRatio.toFixed(2)} (${isPortrait ? 'Portrait' : 'Landscape'})</div>
                <div>Container: ${Math.round(containerWidth)}√ó${Math.round(finalHeight)}px</div>
            `;
            
            // Evaluate the result
            const isValidSize = containerWidth > 0 && finalHeight > 0;
            const hasMinimumSize = containerWidth >= 350 && finalHeight >= 400;
            const fitsInViewport = containerWidth <= availableViewportWidth && finalHeight <= availableViewportHeight;
            
            const result = `
                <div><strong>Testing: ${preset.preset}</strong></div>
                <div><strong>Original Dimensions:</strong> ${preset.width}√ó${preset.height} (${preset.aspectRatio})</div>
                <div><strong>Calculated Aspect Ratio:</strong> ${aspectRatio.toFixed(2)} (${isPortrait ? 'Portrait' : 'Landscape'})</div>
                <div><strong>Available Viewport:</strong> ${availableViewportWidth}√ó${availableViewportHeight}px</div>
                <div><strong>Container Dimensions:</strong> ${Math.round(containerWidth)}√ó${Math.round(finalHeight)}px</div>
                <div class="${isValidSize ? 'success' : 'error'}">
                    Valid Size: ${isValidSize ? '‚úì' : '‚úó'}
                </div>
                <div class="${hasMinimumSize ? 'success' : 'error'}">
                    Minimum Size (350√ó400): ${hasMinimumSize ? '‚úì' : '‚úó'}
                </div>
                <div class="${fitsInViewport ? 'success' : 'warning'}">
                    Fits in Viewport: ${fitsInViewport ? '‚úì' : '‚ö†'}
                </div>
                <div class="${isPortrait ? 'info' : 'info'}">
                    Portrait Logic Applied: ${isPortrait ? '‚úì' : '‚úó'}
                </div>
            `;
            
            document.getElementById('chart-test-result').innerHTML = result;
            
            testResults.chartPreset = {
                preset: presetName,
                dimensions: preset,
                aspectRatio,
                isPortrait,
                containerWidth,
                containerHeight: finalHeight,
                isValidSize,
                hasMinimumSize,
                fitsInViewport
            };
        }

        function updateCalculationsTest() {
            const windowSize = { width: window.innerWidth, height: window.innerHeight };
            const breakpoint = windowSize.width < 768 ? 'mobile' : (windowSize.width < 1200 ? 'tablet' : 'desktop');
            
            // Calculate expected zone total
            const expectedZoneWidths = {
                'mobile': { zone1: 200, zone2: 280, total: 480 },
                'tablet': { zone1: 220, zone2: 320, total: 540 },
                'desktop': { zone1: 240, zone2: 360, total: 600 }
            };
            
            const expected = expectedZoneWidths[breakpoint];
            const availableForChart = windowSize.width - expected.total - 40; // 40px for margins
            
            const result = `
                <div><strong>Responsive Calculations (${breakpoint}):</strong></div>
                <div><strong>Window Size:</strong> ${windowSize.width}√ó${windowSize.height}px</div>
                <div><strong>Expected Zone Total:</strong> ${expected.total}px (Zone1: ${expected.zone1}px + Zone2: ${expected.zone2}px)</div>
                <div><strong>Available for Chart:</strong> ${availableForChart}px</div>
                <div><strong>Chart Deduction Logic:</strong> ${windowSize.width} - 640px (implemented) vs ${expected.total + 40}px (expected)</div>
                <div class="${Math.abs(640 - (expected.total + 40)) <= 20 ? 'success' : 'warning'}">
                    Deduction Accuracy: ${Math.abs(640 - (expected.total + 40)) <= 20 ? '‚úì' : '‚ö† May need adjustment'}
                </div>
            `;
            
            document.getElementById('calculations-result').innerHTML = result;
            
            testResults.calculations = {
                breakpoint,
                windowSize,
                expectedZoneTotal: expected.total,
                availableForChart,
                deductionAccuracy: Math.abs(640 - (expected.total + 40)) <= 20
            };
        }

        function updateSummary() {
            const zoneCorrect = testResults.zoneWidths && 
                testResults.zoneWidths.zone1.correct && 
                testResults.zoneWidths.zone2.correct;
            
            const chartValid = testResults.chartPreset && 
                testResults.chartPreset.isValidSize && 
                testResults.chartPreset.hasMinimumSize;
            
            const calculationsValid = testResults.calculations && 
                testResults.calculations.deductionAccuracy;
            
            const overallStatus = zoneCorrect && chartValid && calculationsValid;
            
            const summary = `
                <div><strong>Overall Test Status:</strong></div>
                <div class="${zoneCorrect ? 'success' : 'error'}">
                    Responsive Zone Widths: ${zoneCorrect ? '‚úì Correct' : '‚úó Issues detected'}
                </div>
                <div class="${chartValid ? 'success' : 'error'}">
                    Chart Size Calculations: ${chartValid ? '‚úì Valid' : '‚úó Issues detected'}
                </div>
                <div class="${calculationsValid ? 'success' : 'warning'}">
                    Viewport Calculations: ${calculationsValid ? '‚úì Accurate' : '‚ö† May need adjustment'}
                </div>
                <div class="${overallStatus ? 'success' : 'error'}">
                    <strong>Overall: ${overallStatus ? '‚úÖ All tests passing' : '‚ùå Some issues detected'}</strong>
                </div>
            `;
            
            document.getElementById('summary-result').innerHTML = summary;
        }

        // Initialize tests
        updateViewportInfo();
        setInterval(updateSummary, 1000);

        // Listen for window resize
        window.addEventListener('resize', updateViewportInfo);
        
        // Initial summary
        setTimeout(updateSummary, 500);
    </script>
</body>
</html>